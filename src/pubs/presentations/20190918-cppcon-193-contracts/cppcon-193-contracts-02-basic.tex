%------------------------------------------------------------------------------
\section{Basic Contracts}
%------------------------------------------------------------------------------
\begin{frame}
  \tableofcontents[currentsection,hidesubsections]
\end{frame}

\subsection{English Contracts}
%------------------------------------------------------------------------------


{\setminted{texcomments}
  \note{2 Minutes}
\begin{frame}<1-5>[fragile,label=section1]
  \frametitle<1-8>{English Contracts}
  \frametitle<9-14>{In code contracts}
  \begin{overprint}
    \onslide<1> Contracts are an agreement between two parties
    \onslide<2> Software contracts are an agreement between a library writer
    and client
    \onslide<3> Function contracts can be rendered in english
    \onslide<4> Describe what a function will do        % highlight up to UB line
    \onslide<5> Describe what behavior is not supported % highlight undefined behavior
    \onslide<6> Preconditions
    \onslide<7> Postconditions
    \onslide<8> Essential Behavior
    \onslide<9> Some parts can be rendered with code
    \onslide<10> Simple boolean predicates
      \begin{cppcodebox}
begin != nullptr
end != nullptr
begin <= end
      \end{cppcodebox}      
    \onslide<11> Predicates about returned value
    \begin{cppcodebox}
return_val >= begin
return_val <= end
return_val == end || *return_val >= val
    \end{cppcodebox}
    \onslide<12> Hard to check things
    \begin{cppcodebox}
is_sorted(begin,end)
    \end{cppcodebox}
    \onslide<13> Uncheckable things?
    \begin{cppcodebox}
is_reachable_from(begin,end)
    \end{cppcodebox}
    \onslide<14> Properties of repeated execution
    \begin{cppcodebox}
      ??????????????????
    \end{cppcodebox}
\end{overprint}
\begin{overprint}
\onslide<3>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<4>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // \highlight{Return a pointer to an element between the}
  // \highlight{specified 'begin' and 'end' that is greater}
  // \highlight{than or equal to the specified 'val', or 'end'}
  // \highlight{if no such value exists.  This function will}
  // \highlight{perform no more than log(distance(begin,end))}
  // \highlight{comparisons.}  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<5>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  \highlight{The  behavior is undefined}
  // \highlight{unless '[begin,end)' is a contiguous sorted}
  // \highlight{range.}
\end{cppcodebox}

\onslide<6>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless \highlight{'[begin,end)' is a contiguous sorted}
  // \highlight{range.}
\end{cppcodebox}

\onslide<7>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // \highlight{Return a pointer to an element between the}
  // \highlight{specified 'begin' and 'end' that is greater}
  // \highlight{than or equal to the specified 'val', or 'end'}
  // \highlight{if no such value exists.}  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<8>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  \highlight{This function will}
  // \highlight{perform no more than log(distance(begin,end))}
  // \highlight{comparisons.}  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<9>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<10>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless \highlight{'[begin,end)'} is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<11>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // \highlight{Return a pointer to an element between the}
  // \highlight{specified 'begin' and 'end' that is greater}
  // \highlight{than or equal to the specified 'val', or 'end'}
  // \highlight{if no such value exists.}  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\onslide<12>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a contiguous \highlight{sorted}
  // range.
\end{cppcodebox}

\onslide<13>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  This function will
  // perform no more than log(distance(begin,end))
  // comparisons.  The  behavior is undefined
  // unless '[begin,end)' is a \highlight{contiguous} sorted
  // \highlight{range.}
\end{cppcodebox}

\onslide<14>
\begin{cppcodebox}
T* binsearch(T*begin, T*end, const T& val);
  // Return a pointer to an element between the
  // specified 'begin' and 'end' that is greater
  // than or equal to the specified 'val', or 'end'
  // if no such value exists.  \highlight{This function will}
  // \highlight{perform no more than log(distance(begin,end))}
  // \highlight{comparisons.}  The  behavior is undefined
  // unless '[begin,end)' is a contiguous sorted
  // range.
\end{cppcodebox}

\end{overprint}

\end{frame}

\begin{frame}
  \frametitle{Undefined Behavior}

  \epigraph{
    \textbf{\only<3>{language }undefined behavior} \\
    behavior for which this document imposes no requirements
    }{N4830 - Working Draft, Standard for Programming Language \Cpp}

  \pause
  \epigraph{
    \textbf{library undefined behavior} \\
    behavior for which a library contract provides no guarantees
    }{John Lakos - CppCon 2014}

\end{frame}

\againframe<5-8>{section1}

\begin{frame}
  \center{Violating a contract is a bug} \\ \pause
  \center{Bugs are contract violations} \\ \pause
  \center{\tiny{Possibly a contract no one wrote down}}
\end{frame}
  
\subsection{In Code Contracts}
%------------------------------------------------------------------------------
\begin{frame}
  \frametitle{What can be checked?}

  \begin{itemize}
  \item Parts of the english contract might be checkable with standard \Cpp expressions. \pause
  \item Parts might have readbale representations that cannot be implemented \pause
  \item Parts might be statements beyond the scope of a single function execution
  \end{itemize}
\end{frame}

\againframe<9-14>{section1}
  }
  
%\begin{frame}
%  \frametitle{Preconditions}
%  % show asserts on inputs
%  % show is-sorted 'safe' check
%  % show in-body assert on sortedness
%\end{frame}
%
%\begin{frame}
%  \frametitle{Sanity Checks}
%  % show asserts for loop invariants,
%  % not often used/mandated, catch these errors with unit tests
%\end{frame}

%\begin{frame}
%  \frametitle{Postconditions}
%  % show assert on output
%  % not often used/mandated, catch these errors with unit tests
%\end{frame}


