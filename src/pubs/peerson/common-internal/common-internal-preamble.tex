%
% This file is included before the document is begun.  Anything here should
% either be included in the publisher-specific preambles or should be mocked
% there to turn any commands that might be used from that preamble into no-ops.

\usepackage[colorinlistoftodos]{todonotes}
\usepackage{letltxmacro}
\GlobalLetLtxMacro{\todoraw}{\todo}
\renewcommand{\todo}[2][]{\todoraw[#1]{\thesection{}. #2}}

\setlength{\marginparwidth}{3.7cm} % needed to make todo notes fill margin

%\usepackage{relsize}               % needed for \textsmaller

% These macros are to match the typesetting used in the C++ standard for the various C++ versions.
% This should be the following, but getting \textsmaller to work consistently with all fonts is nontrivial.
% \newcommand{\Cpp}{\texorpdfstring{C\kern-0.05em\protect\raisebox{.35ex}{\textsmaller[2]{+\kern-0.05em+}}}{C++}}
\newcommand{\Cpp}{C\kern-0.2em\protect\raisebox{.15ex}{+\kern-0.2em+}}
\newcommand{\CppIII}{\Cpp{} 2003}
\newcommand{\CppXI}{\Cpp{} 2011}
\newcommand{\CppXIV}{\Cpp{} 2014}
\newcommand{\CppXVII}{\Cpp{} 2017}
\newcommand{\CppXX}{\Cpp{} 2020}

\definecolor{maroon}{cmyk}{.26,1,.63,.17}
\definecolor{skyblue}{cmyk}{.62,.07,0,0}
\definecolor{forestgreen}{cmyk}{.9,0,.9,0}
\definecolor{mustard}{cmyk}{.22,.14,1,0}
\definecolor{purple}{cmyk}{.83,.81,0,0}
\definecolor{codegray}{cmyk}{0,0,0,.70}

%%% PRINT BOOK SETTINGS
%\lstset{language=C++,basicstyle=\ttfamily\small,framerule=0.5pt,
%emph=[1]{const},
%  emphstyle=[1]{\color{forestgreen}\ttfamily},
%  moreemph=[2]{int,void,char},
%  emphstyle=[2]{\color{forestgreen}\ttfamily},
%    moreemph=[3]{decltype},
%      emphstyle=[3]{\color{forestgreen}\ttfamily},
%    keywordstyle={\color{forestgreen}\ttfamily\bfseries},
%  stringstyle={\color{forestgreen}},
%commentstyle={\color{codegray}\itshape},
%numberstyle=\color{forestgreen},
%xleftmargin=2ex,
%    escapeinside={(첫}{첫)},
%    showstringspaces=false, 
%} % setting the code in small sans serif font and
% setting the margin for the code.  Nov 2015: setting the rules to be 0.5pt
%%%%%%%%%%%%%
%\newcommand{\codeincomments}{\color{codegray}\ttfamily}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%% EBOOK SETTINGS
\lstset{language=C++,basicstyle=\ttfamily\small,framerule=0.5pt,
emph=[1]{const},
  emphstyle=[1]{\color{mustard}\ttfamily},
  moreemph=[2]{int,void,char},
  emphstyle=[2]{\color{maroon}\ttfamily},
    moreemph=[3]{decltype},
      emphstyle=[3]{\color{forestgreen}\ttfamily},
    keywordstyle={\color{forestgreen}\ttfamily\bfseries},
  stringstyle={\color{purple}},
commentstyle={\color{skyblue}\itshape},
numberstyle=\color{purple},
xleftmargin=2ex,
    escapeinside={(첫}{첫)},
    showstringspaces=false, 
} % setting the code in small sans serif font and
%% setting the margin for the code.  Nov 2015: setting the rules to be 0.5pt
%%%%%%%%%%%%%%
\newcommand{\codeincomments}{\color{skyblue}\ttfamily}

% All code samples that should be tested are going to be written within the
% following environment
%
% Source for initial implementation for dumping to files:
% https://tex.stackexchange.com/questions/284189/how-to-dump-listings-to-a-file
\usepackage{currfile}
\makeatletter
\lst@RequireAspects{writefile}

\lstnewenvironment{cppcodeblock}[1]
{\lstset{language=[11]C++}%
 \lst@BeginAlsoWriteFile{listings/#1.lst}
 \immediate\write\lst@WF{// ----Listing start: \currfilename:\the\inputlineno-----}%
}
{ \immediate\write\lst@WF{// ----Listing done: \currfilename:\the\inputlineno-----}%
  \lst@EndWriteFile
}

\newcommand{\cppcode}[1]{\lstinline[language=C++]{#1}}

\makeatother
